<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>QR ‚Üí ESP32 HTTP</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <h3>QR to ESP32 via HTTP</h3>

  <label>ESP32 IP:</label>
  <input id="espIp" value="192.168.1.50" style="width:150px">
  <div id="status">Ready</div>

  <div id="qr-reader" style="width:300px; margin-top:16px;"></div>
  <div style="margin-top:8px;">Last QR: <span id="lastQr"></span></div>

 <script>
  async function sendToEsp32(text) {
    const ip = document.getElementById("espIp").value.trim();
    document.getElementById("status").innerText = `Sending to http://${ip}/qr...`;
    
    const url = `http://${ip}/qr?value=${encodeURIComponent(text)}`;
    console.log("üì° Request:", url);  // Browser console debug
    
    try {
      const res = await fetch(url, { timeout: 5000 });
      const txt = await res.text();
      document.getElementById("status").innerText = "‚úÖ " + txt;
      console.log("‚úÖ Response:", txt);
    } catch (e) {
      document.getElementById("status").innerText = "‚ùå " + e.message;
      console.error("‚ùå Error:", e);
    }
  }

  function onScanSuccess(decodedText) {
    document.getElementById("lastQr").innerText = decodedText;
    sendToEsp32(decodedText);
  }

  // Rest unchanged...
</script>
</body>
</html>
