<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>QR â†’ ESP32 HTTP</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <h3>QR to ESP32 via HTTP</h3>

  <label>ESP32 IP:</label>
  <input id="espIp" value="192.168.1.50" style="width:150px">
  <div id="status">Ready</div>

  <div id="qr-reader" style="width:300px; margin-top:16px;"></div>
  <div style="margin-top:8px;">Last QR: <span id="lastQr"></span></div>

  <script>
    async function sendToEsp32(text) {
      const ip = document.getElementById("espIp").value.trim();
      if (!ip) { alert("Set ESP32 IP first"); return; }

      const url = `http://${ip}/qr?value=${encodeURIComponent(text)}`;
      try {
        const res = await fetch(url);
        const txt = await res.text();
        document.getElementById("status").innerText = "Sent: " + txt;
      } catch (e) {
        document.getElementById("status").innerText = "HTTP error: " + e;
      }
    }

    function onScanSuccess(decodedText, decodedResult) {
      document.getElementById("lastQr").innerText = decodedText;
      sendToEsp32(decodedText);
    }

    function onScanError(errorMessage) {}

    const html5QrCode = new Html5Qrcode("qr-reader");
    Html5Qrcode.getCameras().then(cameras => {
      if (cameras && cameras.length) {
        html5QrCode.start(
          { facingMode: "environment" },
          { fps: 10, qrbox: 250 },
          onScanSuccess,
          onScanError
        );
      }
    }).catch(err => console.error(err));
  </script>
</body>
</html>
